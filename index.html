<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>京都・大阪冬日旅</title>
    
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 載入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 載入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 載入 Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* 自定義樣式變數 */
        :root {
            --color-gold: #C5A059;
            --color-dark: #111111;
            --color-gray: #f9f9f9;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--color-gray);
            color: #333;
        }

        .font-serif-display {
            font-family: 'Noto Serif TC', serif;
        }
        
        .font-eng-serif {
            font-family: 'Playfair Display', serif;
        }

        /* 隱藏捲軸但保留功能 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }

        /* 列印設定 */
        @media print {
            @page { margin: 0; size: A4; }
            body { background-color: white; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-break { break-inside: avoid; page-break-after: always; }
            .print-padding { padding: 20mm !important; }
            /* 強制背景色列印 */
            .bg-dark-header { background-color: #111 !important; color: white !important; }
            .text-gold { color: #C5A059 !important; }
        }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const Icons = {
            Sun: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>,
            Cloud: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>,
            MapPin: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
            Ticket: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="6" width="20" height="12" rx="2"/><circle cx="8" cy="12" r="2"/><path d="M6 12h.01M10 12h10"/></svg>,
            Plus: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Trash: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Link: () => <svg className="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            ExternalLink: () => <svg className="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
            Download: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Eye: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
            Calendar: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        };

        // --- Data ---
        const INITIAL_DAYS = [
          {
            id: 1,
            date: '2/8 (六)',
            weather: 'snowy',
            temperature: '0°C - 3°C',
            transport: 'CI156 / 利木津巴士',
            ticketType: 'Ticket',
            accommodation: '素居旅舍 (Guesthouse Soi)',
            schedule: [
              { id: 1, time: '05:00', activity: '派車接送 (前往機場)', link: '', note: '專車接送至桃機 T2' },
              { id: 2, time: '08:05-11:35', activity: 'CI156 起飛 (T2) -> 抵達 關西 T1', link: '', note: '飛行時間約 2.5 小時' },
              { id: 3, time: '13:00', activity: '利木津巴士往京都車站', link: '', note: 'T1 1F 8號月台購票/上車 (約85分)' },
              { id: 4, time: '14:30', activity: '京都車站用餐', link: '', note: '推薦: 10F 拉麵小路' },
              { id: 5, time: '15:30', activity: '前往飯店 Check-in', link: 'https://guesthousesoi.com/what-we-provide-tw/', note: '公車206號(D2月台)至「馬町」下車' },
              { id: 6, time: '16:30', activity: '清水寺周邊散步', link: '', note: '步行前往 (約10分鐘)' }
            ],
            shopping: [
                { id: 1, name: '京都Porta', location: '京都車站地下街' },
                { id: 2, name: 'Bic Camera', location: 'JR京都站西洞院口' },
                { id: 3, name: 'GU/Uniqlo', location: '京都Avanti' }
            ],
            food: { wishlist: [{ id: 1, name: '京都車站美食', checked: false }], breakfast: '', lunch: '京都車站內', dinner: '飯店附近' },
            notes: '京都車站往素居旅舍交通：\n1. 公車 (最省)：從「烏丸口」D2月台搭市營206號 (往東山通方向)，於「馬町 (Umamachi)」站下車，往回走2分鐘。\n2. 計程車 (推薦)：若行李多，建議直接搭車 (約15分/¥1500)。\n\n【必備APP推薦】\n1. 交通：乘換案內 (Jorudan) 或 NAVITIME (鐵路轉乘/誤點資訊)\n2. 叫車：GO (長輩累了/行李多時救星)\n3. 天氣：tenki.jp (美山/戶外行程精準預報)\n4. 支付：PayPay (備用，現金/信用卡為主)'
          },
          {
            id: 2,
            date: '2/9 (日)',
            weather: 'cloudy',
            temperature: '-1°C - 7°C',
            transport: '京阪電車 / 近鐵',
            ticketType: 'IC Card',
            accommodation: '素居旅舍 (Guesthouse Soi)',
            schedule: [
              { id: 1, time: '09:00', activity: '前往伏見桃山', link: '', note: '京阪電車: 清水五條→伏見桃山 (準急)' },
              { id: 2, time: '09:30', activity: '伏見十石舟/酒藏老街', link: '', note: '步行約10-15分至乘船場' },
              { id: 3, time: '12:00', activity: '午餐', link: '', note: '伏見大手筋商店街' },
              { id: 4, time: '13:30', activity: '前往宇治', link: '', note: '京阪: 伏見桃山→中書島(換月台)→宇治' },
              { id: 5, time: '14:30', activity: '宇治平等院＋抹茶體驗', link: '', note: '步行約10分過宇治橋' },
              { id: 6, time: '17:30', activity: '返回京都', link: '', note: '京阪: 宇治→中書島→清水五條' }
            ],
            shopping: [],
            food: { wishlist: [{ id: 1, name: '中村藤吉', checked: false }], breakfast: '', lunch: '伏見桃山', dinner: '京都' },
            notes: '本日使用 IC Card (西瓜卡/ICOCA) 最方便。\n伏見桃山到宇治需在「中書島」站轉乘京阪宇治線。'
          },
          {
            id: 3,
            date: '2/10 (一)',
            weather: 'sunny',
            temperature: '0°C - 11°C',
            transport: 'E-bike / 步行',
            ticketType: 'Ticket',
            accommodation: '素居旅舍 (Guesthouse Soi)',
            schedule: [
              { id: 1, time: '09:30', activity: '取 E-Bike', link: '', note: '步行前往租車店 (攜帶護照)' },
              { id: 2, time: '09:45-10:15', activity: '高台寺周邊', link: '', note: 'E-bike 慢騎' },
              { id: 3, time: '10:30-11:00', activity: '八坂神社', link: '', note: '騎車/停車休息' },
              { id: 4, time: '11:15-12:45', activity: '祇園/河原町午餐', link: '', note: '將車停在指定停車場後步行用餐' },
              { id: 5, time: '13:00-14:30', activity: '鴨川河岸騎行', link: '', note: '沿河岸自行車道騎乘' },
              { id: 6, time: '14:45-15:30', activity: '下鴨神社 (選)', link: '', note: '騎車前往' },
              { id: 7, time: '15:45-16:30', activity: '京都御苑', link: '', note: '園內寬敞適合騎車' },
              { id: 8, time: '16:45-17:30', activity: '河原町咖啡/甜點', link: '', note: '補充體力' },
              { id: 9, time: '17:30-18:30', activity: '晚餐 (吃完還車)', link: '', note: '注意還車時間' },
              { id: 10, time: '18:30', activity: '返回飯店', link: '', note: '步行或公車' }
            ],
            shopping: [
                { id: 1, name: '唐吉訶德', location: '河原町' },
                { id: 2, name: '松本清、大國藥妝', location: '河原町' }
            ],
            food: { wishlist: [], breakfast: '', lunch: '祇園/河原町', dinner: '河原町' },
            notes: '⚠️老街、神社內禁止騎行，需牽車。腳踏車請停指定停車場。\n清水寺、祇園人潮多，牽車可能比騎車快，要有運動量的心理準備。\n備案：若下雪或不騎車，改走清水寺→祇園→金閣寺→龍安寺路線。'
          },
          {
            id: 4,
            date: '2/11 (二)',
            weather: 'rainy',
            temperature: '1°C - 9°C',
            transport: '租車自駕 (建明租車)',
            ticketType: 'Ticket',
            accommodation: '美山周邊',
            schedule: [
              { id: 1, time: '08:30', activity: '前往租車地取車', link: '', note: '計程車前往車行 (建明租車)' },
              { id: 2, time: '09:00', activity: '出發前往美山', link: '', note: '自駕: 國道162號 (約1.5小時)' },
              { id: 3, time: '11:00', activity: '美山茅草屋之里', link: '', note: '漫遊/拍照' },
              { id: 4, time: '12:30', activity: '美山午餐', link: '', note: '推薦: 蕎麥麵/地雞料理' },
              { id: 5, time: '14:00', activity: '美山周邊漫遊', link: '', note: '道之驛/美山牛乳' },
              { id: 6, time: '16:00', activity: '民宿 Check-in', link: '', note: '享受鄉間寧靜' }
            ],
            shopping: [],
            food: { wishlist: [], breakfast: '', lunch: '美山', dinner: '美山民宿' },
            notes: '建明租車 TEL:03-577-0858。\n【租車注意】\n1. 確認台灣駕照 + 日文譯本都在效期內。\n2. **務必確認車輛配備雪胎 (Snow Tires)**，美山2月有積雪可能，國道162號為山路請小心駕駛。'
          },
          {
            id: 5,
            date: '2/12 (三)',
            weather: 'cloudy',
            temperature: '6°C - 11°C',
            transport: '自駕 / JR',
            ticketType: 'IC Card',
            accommodation: '大阪市區',
            schedule: [
              { id: 1, time: '10:00', activity: '美山出發回程', link: '', note: '自駕: 國道162號往南 -> 嵐山' },
              { id: 2, time: '12:00', activity: '嵐山觀光/午餐', link: '', note: '渡月橋/竹林之道' },
              { id: 3, time: '15:00', activity: '嵐山周邊/往市區', link: '', note: '開車返回京都市區' },
              { id: 4, time: '17:00', activity: '歸還租車', link: '', note: '京都車站附近還車' },
              { id: 5, time: '18:00', activity: '移動往大阪', link: '', note: 'JR新快速: 京都→大阪 (約30分)' },
              { id: 6, time: '18:40', activity: '轉乘地鐵至難波', link: '', note: '御堂筋線: 梅田→難波/心齋橋' },
              { id: 7, time: '19:30', activity: '大阪晚餐', link: '', note: '道頓堀/心齋橋' }
            ],
            shopping: [],
            food: { wishlist: [], breakfast: '', lunch: '嵐山', dinner: '大阪' },
            notes: '今日還車，記得檢查隨身物品。\n【行李移動】若全家行李塞不下車，建議Day 4先寄放京都車站，本日還車後再領取去大阪。'
          },
          {
            id: 6,
            date: '2/13 (四)',
            weather: 'sunny',
            temperature: '2°C - 13°C',
            transport: '新幹線 / JR神戶線',
            ticketType: 'Ticket',
            accommodation: '大阪市區',
            schedule: [
              { id: 1, time: '07:30', activity: '前往新大阪站', link: '', note: '地鐵御堂筋線: 難波→新大阪' },
              { id: 2, time: '08:00', activity: '搭乘新幹線', link: '', note: '新幹線: 新大阪→姬路 (約30分)' },
              { id: 3, time: '08:45', activity: '抵達姬路站', link: '', note: '北口出站' },
              { id: 4, time: '09:00', activity: '前往姬路城', link: '', note: '步行約15-20分 或 搭巴士' },
              { id: 5, time: '09:30', activity: '參觀姬路城', link: '', note: '天守閣 (需爬陡梯)' },
              { id: 6, time: '12:45', activity: '參觀好古園', link: '', note: '就在姬路城旁' },
              { id: 7, time: '16:30', activity: '返回大阪', link: '', note: 'JR新快速: 姬路→大阪 (約60分)' },
              { id: 8, time: '18:00', activity: '晚餐', link: '', note: '心齋橋/道頓堀' }
            ],
            shopping: [
                { id: 1, name: 'piole姬路', location: '姬路站購物中心' },
                { id: 2, name: 'Bic Camera', location: '難波/心齋橋' },
                { id: 3, name: '唐吉訶德(摩天輪)', location: '道頓堀' },
                { id: 4, name: 'GU/Uniqlo', location: '心齋橋(旗艦店)' }
            ],
            food: { wishlist: [{id: 1, name: '穴子丼', checked: false}, {id: 2, name: '姬路關東煮', checked: false}], breakfast: '', lunch: '姬路站周邊', dinner: '大阪難波' },
            notes: '姬路城+好古園聯票 ¥1,050。去程建議搭新幹線省時(¥3800)，回程可搭JR新快速(¥1520)省錢。\n【注意】姬路城需爬非常陡的木樓梯(脫鞋)，膝蓋不好者建議斟酌，或在城下拍照即可。'
          },
          {
            id: 7,
            date: '2/14 (五)',
            weather: 'cloudy',
            temperature: '4°C - 12°C',
            transport: '南海電鐵 / CI173',
            ticketType: 'Ticket',
            accommodation: '溫暖的家',
            schedule: [
              { id: 1, time: '09:00', activity: 'Check-out', link: '', note: '前往南海難波站' },
              { id: 2, time: '10:00', activity: '前往臨空城', link: '', note: '南海電鐵: 難波→臨空城 (空港急行)' },
              { id: 3, time: '10:45', activity: '寄放行李/逛街', link: '', note: '臨空城站內或Outlet置物櫃' },
              { id: 4, time: '16:00', activity: '前往機場', link: '', note: '南海/JR: 臨空城→關西機場 (1站)' },
              { id: 5, time: '19:00', activity: 'CI173 起飛', link: '', note: '關西機場 T1' },
              { id: 6, time: '21:15', activity: '抵達台灣', link: '', note: '桃園機場' }
            ],
            shopping: [{ id: 1, name: 'Rinku Premium Outlets', location: '關西機場旁' }],
            food: { wishlist: [], breakfast: '', lunch: 'Outlet美食街', dinner: '機上/機場' },
            notes: '請務必預留時間退稅與前往機場。臨空城到機場僅需約 6 分鐘車程。'
          }
        ];

        function App() {
            const [days, setDays] = useState(INITIAL_DAYS);
            const [activeDayId, setActiveDayId] = useState(1);
            const [isPreviewMode, setIsPreviewMode] = useState(false); // 預設為編輯模式

            // 讀取存檔 (使用 v16 以區別之前的版本，確保重新載入完整資料)
            useEffect(() => {
                const savedData = localStorage.getItem('kyoto_trip_data_v16');
                if (savedData) {
                    try {
                        setDays(JSON.parse(savedData));
                    } catch (e) {
                        console.error("Data load error:", e);
                    }
                }
            }, []);

            // 寫入存檔
            useEffect(() => {
                localStorage.setItem('kyoto_trip_data_v16', JSON.stringify(days));
            }, [days]);

            const activeDay = days.find(d => d.id === activeDayId) || days[0];

            // Helper to update specific day fields
            const updateDay = (field, value) => {
                setDays(prev => prev.map(d => d.id === activeDayId ? { ...d, [field]: value } : d));
            };

            // Helper to update schedule with auto-sort
            const updateSchedule = (dayId, newSchedule) => {
                const sorted = [...newSchedule].sort((a, b) => a.time.localeCompare(b.time));
                setDays(prev => prev.map(d => d.id === dayId ? { ...d, schedule: sorted } : d));
            };

            // Helper to update shopping
            const updateShopping = (dayId, newShopping) => {
                setDays(prev => prev.map(d => d.id === dayId ? { ...d, shopping: newShopping } : d));
            };

            // Helper to update food
            const updateFood = (dayId, newFood) => {
                setDays(prev => prev.map(d => d.id === dayId ? { ...d, food: newFood } : d));
            };

            // Helper to update wishlist
            const updateWishlist = (dayId, newWishlist) => {
                setDays(prev => prev.map(d => d.id === dayId ? { ...d, food: { ...d.food, wishlist: newWishlist } } : d));
            };

            // Export Text
            const handleExportText = () => {
                let text = `THE KYOTO COLLECTION - 行程表\n\n`;
                days.forEach(day => {
                    text += `【Day ${day.id} - ${day.date}】\n`;
                    text += `天氣: ${day.weather} | 氣溫: ${day.temperature || '-'} | 交通: ${day.transport}\n`;
                    text += `住宿: ${day.accommodation}\n`;
                    text += `--- 行程 ---\n`;
                    day.schedule.forEach(item => {
                        text += `${item.time}  ${item.activity} ${item.note ? `(${item.note})` : ''} ${item.link ? `[Link: ${item.link}]` : ''}\n`;
                    });
                    text += `--- 備註 ---\n${day.notes}\n\n`;
                });
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'kyoto_trip_plan.txt';
                a.click();
            };

            return (
                <div className="min-h-screen flex flex-col">
                    
                    {/* --- HEADER SECTION (Dark Luxury Style) --- */}
                    <div className="bg-[#111111] text-white pt-16 pb-24 px-4 text-center relative overflow-hidden bg-dark-header print:hidden">
                        <div className="max-w-4xl mx-auto relative z-10">
                            <h3 className="text-[#C5A059] tracking-[0.4em] text-xs font-bold mb-4 font-serif-display uppercase text-gold">The Kyoto Collection</h3>
                            <h1 className="text-5xl md:text-7xl font-serif-display font-bold mb-6 tracking-wide text-white">京都7天6夜關西冬之行</h1>
                            
                            <div className="flex justify-center items-center gap-4 text-xs text-gray-400 tracking-widest font-sans">
                                <span className="flex items-center gap-1"><Icons.Calendar/> 2025-02-08 — 2025-02-14</span>
                                <span className="text-[#C5A059] text-gold">•</span>
                                <span className="flex items-center gap-1"><Icons.MapPin/> KYOTO JOURNEY</span>
                            </div>

                            <div className="mt-8 flex justify-center gap-3">
                                <button onClick={() => setIsPreviewMode(!isPreviewMode)} 
                                    className={`px-6 py-2 rounded-full text-xs tracking-widest transition-all border border-[#333] hover:border-[#C5A059] ${isPreviewMode ? 'bg-[#C5A059] text-black' : 'bg-transparent text-gray-300'}`}>
                                    {isPreviewMode ? 'PREVIEW ON' : 'EDIT MODE'}
                                </button>
                                <button onClick={handleExportText} className="px-6 py-2 rounded-full text-xs tracking-widest border border-[#333] hover:border-[#C5A059] text-gray-300 hover:text-[#C5A059] transition-all flex items-center gap-2">
                                    <Icons.Download /> EXPORT
                                </button>
                                <button onClick={() => window.print()} className="px-6 py-2 rounded-full text-xs tracking-widest border border-[#333] hover:border-[#C5A059] text-gray-300 hover:text-[#C5A059] transition-all flex items-center gap-2">
                                    PRINT
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* --- NAVIGATION (Floating) --- */}
                    <div className="sticky top-4 z-50 flex justify-center px-4 -mt-8 mb-12 print:hidden">
                        <div className="bg-[#222] p-1.5 rounded-full shadow-2xl flex gap-1 overflow-x-auto border border-[#333]">
                            {days.map(day => (
                                <button
                                    key={day.id}
                                    onClick={() => setActiveDayId(day.id)}
                                    className={`px-6 py-2 rounded-full text-xs font-bold tracking-widest transition-all whitespace-nowrap
                                        ${activeDayId === day.id 
                                        ? 'bg-[#C5A059] text-black shadow-lg' 
                                        : 'text-gray-400 hover:text-white'}`}
                                >
                                    DAY {String(day.id).padStart(2, '0')}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* --- MAIN CONTENT CARD --- */}
                    <main className="flex-grow max-w-5xl mx-auto w-full px-4 md:px-8 pb-20 print:max-w-none print:px-0">
                        {(isPreviewMode ? days : [activeDay]).map((day) => (
                            <div key={day.id} className="bg-white shadow-xl rounded-sm p-8 md:p-12 mb-12 border-t-4 border-[#C5A059] print:shadow-none print:border-none print-break print-padding">
                                
                                {/* Day Header */}
                                <div className="flex flex-col md:flex-row justify-between items-start md:items-end border-b border-gray-100 pb-8 mb-10 relative">
                                    <div className="relative z-10">
                                        <div className="flex items-baseline">
                                            <span className="text-9xl font-eng-serif font-bold text-gray-100 absolute -top-12 -left-6 -z-10 select-none">
                                                {String(day.id).padStart(2, '0')}
                                            </span>
                                            <h2 className="text-4xl font-serif-display font-bold text-gray-800 ml-2">
                                                {day.date.split(' ')[0]} <span className="text-xl font-light text-gray-400">{day.date.split(' ')[1]}</span>
                                            </h2>
                                        </div>
                                        
                                        <div className="flex flex-wrap gap-4 mt-4 text-xs font-bold tracking-wider text-gray-500 uppercase">
                                            <div className="flex items-center gap-1.5">
                                                <Icons.Sun /> 
                                                {!isPreviewMode ? 
                                                    <input value={day.weather} onChange={e => updateDay('weather', e.target.value)} className="border-b border-gray-300 w-16 bg-transparent focus:outline-none focus:border-[#C5A059]" /> 
                                                    : day.weather
                                                }
                                            </div>
                                            <div className="flex items-center gap-1.5">
                                                <span className="text-[#C5A059]">•</span> {day.temperature || '-'}
                                            </div>
                                            <div className="flex items-center gap-1.5">
                                                <Icons.Ticket /> 
                                                {!isPreviewMode ?
                                                    <input value={day.transport} onChange={e => updateDay('transport', e.target.value)} className="border-b border-gray-300 w-24 bg-transparent focus:outline-none focus:border-[#C5A059]" /> 
                                                    : day.transport
                                                }
                                            </div>
                                        </div>
                                    </div>

                                    {/* Accommodation Badge */}
                                    <div className="mt-6 md:mt-0 flex items-center gap-3 bg-gray-50 px-4 py-3 rounded-r-lg border-l-2 border-[#C5A059]">
                                        <div className="p-2 bg-white rounded-full shadow-sm text-[#C5A059]">
                                            <Icons.MapPin />
                                        </div>
                                        <div>
                                            <div className="text-[10px] text-gray-400 font-bold tracking-widest uppercase">住宿</div>
                                            <div className="text-sm font-serif-display font-bold text-gray-800">
                                                {!isPreviewMode ? <input value={day.accommodation} onChange={e => updateDay('accommodation', e.target.value)} className="bg-transparent w-full focus:outline-none" /> : day.accommodation}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Content Grid */}
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-12">
                                    
                                    {/* Left: Itinerary Flow */}
                                    <div className="lg:col-span-2">
                                        <div className="flex justify-between items-center mb-8">
                                            <h3 className="text-xs font-bold tracking-[0.2em] text-gray-400 uppercase">行程路線</h3>
                                            {!isPreviewMode && (
                                                <button onClick={() => updateSchedule(day.id, [...day.schedule, {id: Date.now(), time: '10:00', activity: '', note: ''}])} className="text-[#C5A059] hover:text-black transition-colors">
                                                    <Icons.Plus />
                                                </button>
                                            )}
                                        </div>

                                        <div className="relative border-l border-gray-200 ml-2.5 space-y-8 pb-4">
                                            {day.schedule.map((item, idx) => (
                                                <div key={item.id} className="relative pl-8 group">
                                                    {/* Square Marker */}
                                                    <div className="absolute -left-[5px] top-1.5 w-2.5 h-2.5 bg-white border border-[#C5A059] transform rotate-45"></div>
                                                    
                                                    <div className="flex gap-6 items-baseline">
                                                        <div className="w-16 flex-shrink-0 text-sm font-serif-display font-bold text-[#C5A059] opacity-80">
                                                            {!isPreviewMode ? 
                                                                <input value={item.time} onChange={e => {
                                                                    const updated = day.schedule.map(s => s.id === item.id ? {...s, time: e.target.value} : s);
                                                                    updateSchedule(day.id, updated);
                                                                }} className="bg-transparent w-full focus:outline-none" /> 
                                                                : item.time}
                                                        </div>
                                                        <div className="flex-grow">
                                                            <div className="text-base font-bold text-gray-800 tracking-wide mb-1">
                                                                {!isPreviewMode ? 
                                                                    <input value={item.activity} onChange={e => {
                                                                        const updated = day.schedule.map(s => s.id === item.id ? {...s, activity: e.target.value} : s);
                                                                        updateSchedule(day.id, updated);
                                                                    }} className="bg-transparent w-full focus:outline-none border-b border-gray-100 focus:border-[#C5A059]" placeholder="行程內容" /> 
                                                                    : (item.link ? 
                                                                        <a href={item.link} target="_blank" rel="noopener noreferrer" className="hover:text-[#C5A059] border-b-2 border-[#C5A059] transition-colors pb-0.5">{item.activity}</a> 
                                                                        : item.activity)
                                                                }
                                                            </div>
                                                            
                                                            {/* Note & Transport Detail */}
                                                            <div className="text-sm font-light text-gray-500">
                                                                {!isPreviewMode ? 
                                                                    <input value={item.note || ''} onChange={e => {
                                                                        const updated = day.schedule.map(s => s.id === item.id ? {...s, note: e.target.value} : s);
                                                                        updateSchedule(day.id, updated);
                                                                    }} className="bg-transparent w-full focus:outline-none text-xs text-gray-400" placeholder="交通/備註..." /> 
                                                                    : item.note}
                                                            </div>

                                                            {/* Link Input (Edit Mode) */}
                                                            {!isPreviewMode && (
                                                                <div className="flex items-center gap-2 mt-2">
                                                                    <Icons.Link />
                                                                    <input value={item.link || ''} onChange={e => {
                                                                        const updated = day.schedule.map(s => s.id === item.id ? {...s, link: e.target.value} : s);
                                                                        updateSchedule(day.id, updated);
                                                                    }} className="text-xs text-gray-400 bg-transparent w-full focus:outline-none" placeholder="http://" />
                                                                    
                                                                    {/* Test Link Button */}
                                                                    {item.link && (
                                                                        <a href={item.link} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-[#C5A059] transition-colors">
                                                                            <Icons.ExternalLink />
                                                                        </a>
                                                                    )}

                                                                    <button onClick={() => updateSchedule(day.id, day.schedule.filter(s => s.id !== item.id))} className="text-gray-300 hover:text-red-400"><Icons.Trash /></button>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Right: Curated Stores & Dining */}
                                    <div className="space-y-12">
                                        
                                        {/* Shopping */}
                                        <div>
                                            <div className="flex justify-between items-center mb-6 border-b border-gray-100 pb-2">
                                                <h3 className="text-xs font-bold tracking-[0.2em] text-gray-400 uppercase">精選店家</h3>
                                                {!isPreviewMode && (
                                                    <button onClick={() => updateShopping(day.id, [...day.shopping, {id: Date.now(), name: '', location: ''}])} className="text-[#C5A059]">
                                                        <Icons.Plus />
                                                    </button>
                                                )}
                                            </div>
                                            <div className="space-y-4">
                                                {day.shopping.length === 0 && <p className="text-xs text-gray-300 italic">No shopping planned.</p>}
                                                {day.shopping.map(shop => (
                                                    <div key={shop.id} className="group">
                                                        <div className="text-sm font-bold text-gray-800">
                                                            {!isPreviewMode ? 
                                                                <input value={shop.name} onChange={e => {
                                                                    const updated = day.shopping.map(s => s.id === shop.id ? {...s, name: e.target.value} : s);
                                                                    updateShopping(day.id, updated);
                                                                }} className="bg-transparent w-full focus:outline-none" placeholder="Shop Name" /> 
                                                                : shop.name}
                                                        </div>
                                                        <div className="text-xs text-gray-400 font-light flex justify-between items-center">
                                                            {!isPreviewMode ? 
                                                                <input value={shop.location} onChange={e => {
                                                                    const updated = day.shopping.map(s => s.id === shop.id ? {...s, location: e.target.value} : s);
                                                                    updateShopping(day.id, updated);
                                                                }} className="bg-transparent w-full focus:outline-none" placeholder="Location" /> 
                                                                : shop.location}
                                                            {!isPreviewMode && <button onClick={() => updateShopping(day.id, day.shopping.filter(s => s.id !== shop.id))} className="opacity-0 group-hover:opacity-100 text-gray-300 hover:text-red-400"><Icons.Trash /></button>}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Dining & Notes */}
                                        <div>
                                            <h3 className="text-xs font-bold tracking-[0.2em] text-gray-400 uppercase mb-6 border-b border-gray-100 pb-2">美食筆記</h3>
                                            
                                            <div className="space-y-4 mb-8">
                                                {['breakfast', 'lunch', 'dinner'].map(meal => (
                                                    <div key={meal} className="flex gap-4 text-sm">
                                                        <span className="text-[#C5A059] uppercase text-xs font-bold w-12 pt-1 tracking-wider">
                                                            {meal === 'breakfast' ? '早餐' : meal === 'lunch' ? '午餐' : '晚餐'}
                                                        </span>
                                                        <div className="text-gray-700 font-medium flex-grow border-b border-gray-100 pb-1">
                                                            {!isPreviewMode ? 
                                                                <input value={day.food[meal]} onChange={e => updateFood(day.id, {...day.food, [meal]: e.target.value})} className="bg-transparent w-full focus:outline-none" /> 
                                                                : (day.food[meal] || '-')}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* Wishlist Section */}
                                            <div className="mb-8">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h4 className="text-[10px] font-bold text-gray-400 uppercase tracking-widest">想吃清單</h4>
                                                    {!isPreviewMode && (
                                                        <button onClick={() => updateWishlist(day.id, [...day.food.wishlist, {id: Date.now(), name: '', checked: false}])} className="text-[#C5A059]">
                                                            <Icons.Plus />
                                                        </button>
                                                    )}
                                                </div>
                                                <div className="space-y-2">
                                                    {day.food.wishlist.map(item => (
                                                        <div key={item.id} className="flex items-center gap-2 text-sm group">
                                                            <input type="checkbox" checked={item.checked} onChange={e => {
                                                                const updated = day.food.wishlist.map(w => w.id === item.id ? {...w, checked: e.target.checked} : w);
                                                                updateWishlist(day.id, updated);
                                                            }} className="accent-[#C5A059]" />
                                                            
                                                            {!isPreviewMode ? 
                                                                <input value={item.name} onChange={e => {
                                                                    const updated = day.food.wishlist.map(w => w.id === item.id ? {...w, name: e.target.value} : w);
                                                                    updateWishlist(day.id, updated);
                                                                }} className={`bg-transparent w-full focus:outline-none ${item.checked ? 'line-through text-gray-300' : 'text-gray-700'}`} placeholder="想吃的小吃..." />
                                                                : <span className={`${item.checked ? 'line-through text-gray-300' : 'text-gray-700'}`}>{item.name}</span>
                                                            }
                                                            
                                                            {!isPreviewMode && <button onClick={() => updateWishlist(day.id, day.food.wishlist.filter(w => w.id !== item.id))} className="opacity-0 group-hover:opacity-100 text-gray-300 hover:text-red-400"><Icons.Trash /></button>}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Notes Block */}
                                            <div className="bg-gray-50 p-6 rounded-sm border-l-4 border-gray-200">
                                                <h4 className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3">備註 & 提醒</h4>
                                                {!isPreviewMode ? 
                                                    <textarea value={day.notes} onChange={e => updateDay('notes', e.target.value)} className="w-full bg-transparent text-sm text-gray-600 leading-relaxed focus:outline-none resize-none h-48" /> 
                                                    : <p className="text-sm text-gray-600 leading-relaxed whitespace-pre-wrap font-light">{day.notes}</p>
                                                }
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        ))}
                    </main>

                    {/* Footer */}
                    <footer className="text-center py-10 text-xs text-gray-400 tracking-widest font-sans border-t border-gray-200 print:hidden">
                        KYOTO COLLECTION 2025
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
